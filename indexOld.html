<!doctype html>
<html>
<head></head>
<body>
</body>
<div id="viewport">
<div id="lake">
<div id="duck"></div>
<div id="fox"></div>
<div id="center"></div>
</div>
</div>

<script>
const sizeLake = 200;
const sizePoint = 10;


window.onload = () => {
    let duck = document.getElementById('duck');
    let fox = document.getElementById('fox');
    let lake = document.getElementById('lake');
    
    let mouseX = sizeLake / 2;
    let mouseY = sizeLake / 2;
    
    let duckX = sizeLake / 2;
    let duckY = sizeLake / 2;
    
    let foxAlpha = 0;
    
    
    /*
    lake.onmousemove = e => {
    //console.info(e);
        mouseX = e.clientX - 200;
        mouseY = e.clientY - 200;
    };
    */
    
    
    document.getElementById('viewport').onmousemove = e => {
       mouseX = e.clientX - lake.offsetLeft;
       mouseY = e.clientY - lake.offsetTop;
    // console.info('a');   
    }
    //*/
    
    
    let duckSpeed = 1;
    let foxSpeed = duckSpeed * 4;
    
    setInterval(() => {
        let MAGIC = sizeLake + 2.5;
        
        if (duckX != mouseX || duckY != mouseY) {
            let deltaX = mouseX - duckX;
            let deltaY = mouseY - duckY;
            let deltaLength = Math.sqrt(deltaX*deltaX + deltaY*deltaY);
            if (deltaLength > duckSpeed) {
                deltaX = deltaX / deltaLength * duckSpeed;
                deltaY = deltaY / deltaLength * duckSpeed;
            }
            
            duckX += deltaX;
            duckY += deltaY;
  
            if (duckX < 0) {
                duckX = 0;
            }
            if (duckX > sizeLake) {
                duckX = sizeLake;
            }
            if (duckY < 0) {
                duckY = 0;
            }
            if (duckY > sizeLake) {
                duckY = sizeLake;
            }
            duck.style.left = Math.round(duckX + MAGIC) + "px";
            duck.style.top = Math.round(duckY + MAGIC) + "px";;
         
           //console.info(duckX, duckY);
        }
        
        
        let duckR = Math.sqrt( (duckX-sizeLake/2)*(duckX-sizeLake/2) + (duckY-sizeLake/2)*(duckY-sizeLake/2));
        
        
        let targetAlpha = duckR ? Math.acos( (duckX - sizeLake/2) / duckR ) : foxAlpha;
        if ((duckY - sizeLake/2) / duckR > 0 ) {
            targetAlpha = 2 * Math.PI - targetAlpha;
        }
        //console.info(duckX, duckY, duckfoxAlpha, targetAlpha);
        if (foxAlpha != targetAlpha) {
            let foxAlphaDelta = targetAlpha - foxAlpha;
            if (foxAlphaDelta > Math.PI) {                         
                foxAlphaDelta = foxAlphaDelta - 2*Math.PI;
            }
            if (foxAlphaDelta < -1 * Math.PI) {
                foxAlphaDelta = 2*Math.PI + foxAlphaDelta;
            }
            let foxAlphaSpeed = foxSpeed / (sizeLake / 2);            
            if (foxAlphaDelta > foxAlphaSpeed) {
                foxAlphaDelta = foxAlphaSpeed;
            }
            if (foxAlphaDelta < -1 * foxAlphaSpeed) {
                foxAlphaDelta = -1 * foxAlphaSpeed;
            }            
            foxAlpha += foxAlphaDelta;
            if (foxAlpha < 0) {
                foxAlpha = foxAlpha + 2*Math.PI;
            }
            if (foxAlpha >= 2*Math.PI) {
                foxAlpha = foxAlpha - 2*Math.PI;
            }
            
        }
        //console.info(targetAlpha, foxAlpha);
        let foxX = sizeLake/2 + Math.cos(foxAlpha)*sizeLake/2;
        let foxY = sizeLake/2 - Math.sin(foxAlpha)*sizeLake/2
        fox.style.left = Math.round(foxX + MAGIC) + "px";
        fox.style.top = Math.round(foxY + MAGIC) + "px";

        //console.info(duckX,duckY, Math.sqrt((duckX-sizeLake/2)*(duckX-sizeLake/2) + (duckY-sizeLake/2)*(duckY-sizeLake/2) ), sizeLake/2);
        if ( Math.sqrt((duckX-sizeLake/2)*(duckX-sizeLake/2) + (duckY-sizeLake/2)*(duckY-sizeLake/2) ) >= sizeLake / 2) {
        //console.info(duckX, duckY, foxX, foxY, (foxX-duckX)*(foxX-duckX) + (foxY-duckY)*(foxY-duckY))
            if ((foxX-duckX)*(foxX-duckX) + (foxY-duckY)*(foxY-duckY) < sizePoint / 2) {                
                console.info('Fail');
            } else {
                console.info(`You won`);
            }
            duckX = sizeLake/2;
            duckY = sizeLake/2;
        }
        
    }, 20);
}
</script>
<style>
#lake {
}
#lake, #fox, #duck {
    box-sizing: border-box;
}
#lake {
    margin: 200px;
    background-color: lightgrey;
    max-width: 200px;
    border-radius: 100px;
    width: 200px;
    height: 200px;
    max-height: 200px;
    display: inline-block;
    border: 2px solid black;
}
#duck {
    background-color: yellow;
}
#fox {
    background-color: green;
}
#duck, #fox {
    position: absolute;
    height: 10px;
    width: 10px;
    border-radius: 5px;
    display: inline-block;    
}
#center {
    position: absolute;
    height: 2px;
    width: 2px;
    background: black;
    left: 305px;
    top: 305px;
    display: inline-block;
}
</style>
</html>
